<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Made with Love - Fast Order Form</title>
    
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.1/font/bootstrap-icons.css">
    <link href="https://fonts.googleapis.com/css2?family=Outfit:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
        :root {
            --bg-body: #050505; --bg-card: #141414; --bg-input: #222222;
            --text-main: #ffffff; --text-secondary: #e0e0e0; 
            --accent-gold: #FFD700; 
        }
        body { background-color: var(--bg-body); color: var(--text-main); font-family: 'Outfit', sans-serif; padding-bottom: 50px; }
        .brand-title { color: white; font-weight: 800; letter-spacing: 1px; }
        .dark-card { background-color: var(--bg-card); border: 1px solid #2a2a2a; border-radius: 16px; padding: 25px; margin-bottom: 15px; }
        .form-control, .form-select { background-color: var(--bg-input); border: 1px solid #444; color: white; border-radius: 10px; padding: 12px; }
        .form-control:focus, .form-select:focus { background-color: #333; border-color: var(--accent-gold); color: white; box-shadow: 0 0 5px rgba(255, 215, 0, 0.3); }
        .form-label { color: #aaa; font-size: 0.75rem; text-transform: uppercase; margin-bottom: 6px; }
        .warning-text { font-size: 0.75rem; color: #ffb8b8; margin-top: 5px; }
        
        .btn-premium { background: linear-gradient(135deg, #FFD700 0%, #FDB931 100%); border: none; color: #000; font-weight: 700; border-radius: 12px; padding: 14px; width: 100%; transition: all 0.2s; }
        .btn-premium:disabled { background: #555; color: #888; cursor: not-allowed; }
        .btn-outline-gold { background: transparent; border: 1px solid var(--accent-gold); color: var(--accent-gold); font-weight: 600; border-radius: 12px; padding: 14px; width: 100%; }
        .btn-add-photo { border: 1px dashed #666; color: #aaa; background: transparent; padding: 10px; border-radius: 10px; width: 100%; text-align: center; cursor: pointer; transition: 0.3s;}
        .btn-add-photo:hover { border-color: #fff; color: #fff; background: rgba(255,255,255,0.05); }

        #reviewOverlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.95); backdrop-filter: blur(8px); z-index: 2000; display: none; align-items: center; justify-content: center; }
        #reviewOverlay.active { display: flex; }
        .review-card { background: #111; border: 1px solid #333; border-radius: 20px; padding: 30px; width: 90%; max-width: 450px; }
        .review-data p { margin-bottom: 8px; padding-bottom: 8px; border-bottom: 1px solid #222; font-size: 0.9rem; color: #ccc;}
        .review-data strong { color: white; display: inline-block; width: 80px; }
    </style>
</head>
<body>

<div id="reviewOverlay">
    <div class="review-card">
        <h4 class="text-white mb-4 fw-bold text-center">REVIEW ORDER</h4>
        <div id="modalBody" class="review-data"></div>
        <div class="row g-2 mt-4">
            <div class="col-6"><button class="btn btn-outline-secondary w-100 py-3 rounded-3" onclick="closeReview()">EDIT</button></div>
            <div class="col-6"><button id="confirmSubmitBtn" class="btn-premium py-3">CONFIRM</button></div>
        </div>
    </div>
</div>

<div class="container py-4" style="max-width: 600px;">
    <div class="mb-4 px-1"><h3 class="brand-title mb-0">Made with Love ü§ç</h3><small class="text-secondary">PLACE YOUR ORDER</small></div>

    <div class="dark-card">
        <form id="orderForm">
            <h6 class="text-warning mb-3 fw-bold border-bottom border-secondary pb-2">Sender Info</h6>
            <div class="row g-2 mb-3">
                <div class="col-6"><label class="form-label">Name *</label><input type="text" class="form-control" id="senderName" required></div>
                <div class="col-6"><label class="form-label">Phone *</label><input type="tel" class="form-control" id="senderPhone" required></div>
            </div>

            <h6 class="text-warning mb-3 fw-bold border-bottom border-secondary pb-2 mt-4">Receiver Info</h6>
            <div class="row g-2 mb-3">
                <div class="col-6"><label class="form-label">Name *</label><input type="text" class="form-control" id="receiverName" required></div>
                <div class="col-6"><label class="form-label">Phone</label><input type="tel" class="form-control" id="receiverPhone"></div>
            </div>

            <div class="mb-3">
                <label class="form-label">Full Address *</label>
                <textarea class="form-control" id="address" rows="2" required></textarea>
            </div>

            <h6 class="text-warning mb-3 fw-bold border-bottom border-secondary pb-2 mt-4">Order Details</h6>
            <div class="mb-3"><label class="form-label">Message</label><input type="text" class="form-control" id="cardMessage"></div>

            <div class="row g-2 mb-3">
                <div class="col-6"><label class="form-label">Date *</label><input type="date" class="form-control" id="deliveryDate" required></div>
                <div class="col-6">
                    <label class="form-label">Time *</label>
                    <select class="form-select" id="deliveryTime" required>
                        <option value="" selected disabled>Select Time</option>
                        <option value="8:00 AM - 12:00 PM">8:00 AM - 12:00 PM</option>
                        <option value="2:00 PM - 4:00 PM">2:00 PM - 4:00 PM</option>
                        <option value="4:00 PM - 6:00 PM">4:00 PM - 6:00 PM</option>
                        <option value="6:00 PM - 8:00 PM">6:00 PM - 8:00 PM</option>
                        <option value="7:00 PM - 9:00 PM">7:00 PM - 9:00 PM</option>
                    </select>
                </div>
            </div>

            <div class="mb-4">
                <label class="form-label">Upload Item Photos *</label>
                
                <div id="photoInputsContainer">
                    <input type="file" class="form-control item-photo mb-2" accept="image/*" required>
                    <input type="file" class="form-control item-photo mb-2" accept="image/*" required>
                    <input type="file" class="form-control item-photo mb-2" accept="image/*" required>
                </div>
                
                <div class="btn-add-photo" id="addPhotoBtn">
                    <i class="bi bi-plus-circle"></i> Upload another
                </div>
                <div class="warning-text">·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ ·Äï·ÄØ·Ä∂ (·ÅÉ) ·Äï·ÄØ·Ä∂ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äõ·Äî·Ä∫ ·Äú·Ä≠·ÄØ·Ä°·Äï·Ä∫·Äï·Ä´·Äû·Ää·Ä∫·Åã</div>
            </div>

            <button type="button" id="checkBtn" class="btn-outline-gold mt-2">REVIEW ORDER</button>
        </form>
    </div>
</div>

<script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
    import { getDatabase, ref, push, set } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-database.js";

    const firebaseConfig = {
      apiKey: "AIzaSyD6txNwU9zsYWeDjrSTf25k20ZgZA0CBGc",
      authDomain: "made-with-love-by-me-2dee6.firebaseapp.com",
      databaseURL: "https://made-with-love-by-me-2dee6-default-rtdb.asia-southeast1.firebasedatabase.app",
      projectId: "made-with-love-by-me-2dee6"
    };

    const app = initializeApp(firebaseConfig);
    const db = getDatabase(app);

    // ==========================================
    // IMGBB MULTIPLE API KEYS CONFIGURATION
    // ==========================================
    // ·Ä°·ÄÖ·Ä∫·ÄÄ·Ä≠·ÄØ·Äï·Ä±·Ä∏·Äë·Ä¨·Ä∏·Äê·Ä≤·Ä∑ API Key ·ÅÖ ·ÄÅ·ÄØ·Äú·ÄØ·Ä∂·Ä∏·ÄÄ·Ä≠·ÄØ ·Äë·Ää·Ä∑·Ä∫·Äë·Ä¨·Ä∏·Äï·Ä±·Ä∏·Äï·Ä´·Äê·Äö·Ä∫
    const IMGBB_API_KEYS = [
        "fca43303d3bb6971a4c61e422bf6ddd5",
        "c1190bd9ef92cce935c5e0d56b907e68",
        "5ceb148dc675b17f0284b24cfccacbf7",
        "1875bfd9888c4eb58a5ac981e510cbbe",
        "eeef7e2a7c3324559471d3f2ddaea7c5"
    ];

    // ·Äï·ÄØ·Ä∂·Äê·ÄÖ·Ä∫·Äï·ÄØ·Ä∂·ÄÅ·Äª·ÄÑ·Ä∫·Ä∏·ÄÖ·ÄÆ·Ä°·Äê·ÄΩ·ÄÄ·Ä∫ Key ·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ ·Ä°·Äú·Äæ·Ää·Ä∑·Ä∫·ÄÄ·Äª (Index) ·Ä°·Äê·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏ ·ÄÅ·ÄΩ·Ä≤·Äû·ÄØ·Ä∂·Ä∏·Äï·Ä´·Äô·Äö·Ä∫
    const uploadToImgBB = async (file, index) => {
        const keyToUse = IMGBB_API_KEYS[index % IMGBB_API_KEYS.length]; // Key ·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ ·Ä°·Äú·Äæ·Ää·Ä∑·Ä∫·ÄÄ·Äª·Äö·Ä∞·Äô·Äö·Ä∫
        
        const formData = new FormData();
        formData.append("image", file);

        const response = await fetch(`https://api.imgbb.com/1/upload?key=${keyToUse}`, {
            method: "POST",
            body: formData
        });
        const data = await response.json();
        if (data.success) {
            return data.data.url; 
        } else {
            throw new Error(`ImgBB Upload Failed on Key ${index + 1}`);
        }
    };

    // --- Dynamic "Upload Another" Button ---
    document.getElementById('addPhotoBtn').addEventListener('click', () => {
        const container = document.getElementById('photoInputsContainer');
        const input = document.createElement('input');
        input.type = 'file';
        input.className = 'form-control item-photo mb-2';
        input.accept = 'image/*';
        container.appendChild(input);
    });

    const reviewOverlay = document.getElementById('reviewOverlay');
    let selectedFiles = [];

    document.getElementById('checkBtn').addEventListener('click', () => {
        selectedFiles = [];
        const inputs = document.querySelectorAll('.item-photo');
        inputs.forEach(input => {
            if (input.files.length > 0) {
                selectedFiles.push(input.files[0]);
            }
        });

        if (selectedFiles.length < 3) return alert("‚ö†Ô∏è ·Äï·ÄØ·Ä∂ ·Ä°·Äî·Ää·Ä∫·Ä∏·ÄÜ·ÄØ·Ä∂·Ä∏ (·ÅÉ) ·Äï·ÄØ·Ä∂ ·Äë·Ää·Ä∑·Ä∫·Äï·Ä±·Ä∏·Äï·Ä´·Åã");
        if (!document.getElementById('orderForm').checkValidity()) return document.getElementById('orderForm').reportValidity();

        document.getElementById('modalBody').innerHTML = `
            <p><strong>From:</strong> ${document.getElementById('senderName').value}</p>
            <p><strong>To:</strong> ${document.getElementById('receiverName').value}</p>
            <p><strong>Address:</strong> ${document.getElementById('address').value}</p>
            <p><strong>Delivery:</strong> ${document.getElementById('deliveryDate').value} @ ${document.getElementById('deliveryTime').value}</p>
            <p><strong>Photos:</strong> <span class="text-success">${selectedFiles.length} images ready</span></p>
        `;
        reviewOverlay.classList.add('active');
    });

    window.closeReview = () => reviewOverlay.classList.remove('active');

    // --- FAST UPLOAD LOGIC ---
    document.getElementById('confirmSubmitBtn').addEventListener('click', async () => {
        const btn = document.getElementById('confirmSubmitBtn');
        btn.innerText = "UPLOADING FAST...";
        btn.disabled = true;

        try {
            // ·Äï·ÄØ·Ä∂·Äê·ÄΩ·Ä±·ÄÄ·Ä≠·ÄØ API Key ·ÄÅ·ÄΩ·Ä≤·Äï·Äº·ÄÆ·Ä∏ ·Äê·ÄÖ·Ä∫·Äï·Äº·Ä≠·ÄØ·ÄÑ·Ä∫·Äî·ÄÄ·Ä∫·Äê·Ää·Ä∫·Ä∏ ·Ä°·ÄÄ·ÄØ·Äî·Ä∫·Äï·Ä≠·ÄØ·Ä∑·Äô·Äö·Ä∫ (Very Fast)
            const uploadedUrls = await Promise.all(selectedFiles.map((file, index) => uploadToImgBB(file, index)));

            // Save text links to Firebase DB
            await set(push(ref(db, 'orders')), {
                senderName: document.getElementById('senderName').value,
                senderPhone: document.getElementById('senderPhone').value,
                receiverName: document.getElementById('receiverName').value,
                receiverPhone: document.getElementById('receiverPhone').value,
                address: document.getElementById('address').value,
                cardMessage: document.getElementById('cardMessage').value,
                deliveryDate: document.getElementById('deliveryDate').value,
                deliveryTime: document.getElementById('deliveryTime').value,
                images: uploadedUrls, 
                status: "Pending",
                timestamp: Date.now()
            });

            alert("‚úÖ Order Submitted Successfully!");
            closeReview();
            document.getElementById('orderForm').reset();
            document.getElementById('photoInputsContainer').innerHTML = `
                <input type="file" class="form-control item-photo mb-2" accept="image/*" required>
                <input type="file" class="form-control item-photo mb-2" accept="image/*" required>
                <input type="file" class="form-control item-photo mb-2" accept="image/*" required>
            `;
        } catch (error) { 
            console.error(error);
            alert("‚ùå Error: Upload ·ÄÅ·Äª·Ä≠·ÄØ·Ä∑·Äö·ÄΩ·ÄÑ·Ä∫·Ä∏·Äû·ÄΩ·Ä¨·Ä∏·Äï·Ä´·Äû·Ää·Ä∫·Åã ·Ä°·ÄÑ·Ä∫·Äê·Ä¨·Äî·ÄÄ·Ä∫·Äú·Ä≠·ÄØ·ÄÑ·Ä∫·Ä∏ ·ÄÖ·ÄÖ·Ä∫·ÄÜ·Ä±·Ä∏·Äï·Ä´·Åã"); 
        } finally { 
            btn.innerText = "CONFIRM"; 
            btn.disabled = false; 
        }
    });
</script>
</body>
</html>
